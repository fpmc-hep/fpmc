set(processes sqme_aaaa sqme_aazz sqme_aaww)
set(ch_dir "${PROJECT_SOURCE_DIR}/External/comphep_interface/")

#file(GLOB comphep_sources sqme_aaaa/src/*.cpp sqme_aazz/src/*.cpp sqme_aaww/src/*.cpp)
#foreach(_proc ${processes})
#  include_directories(${_proc}/comphep/include)
#endforeach()
#include_directories(commons)
#message(STATUS ${comphep_sources})
#set(GCC_COVERAGE_COMPILE_FLAGS "-DNUM_DOUBLE -DCOMPHEP")
foreach(_proc ${processes})
  #add_custom_command(OUTPUT ${_proc} COMMAND make WORKING_DIRECTORY ${ch_dir}${_proc})
  #add_custom_command(OUTPUT ${ch_dir}/lib${_proc}.so COMMAND make WORKING_DIRECTORY ${ch_dir}${_proc})
  #add_custom_command(OUTPUT lib${_proc}.so COMMAND make WORKING_DIRECTORY ${ch_dir}${_proc})
  add_custom_command(OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/bin/lib${_proc}.so COMMAND make WORKING_DIRECTORY ${ch_dir}${_proc})
  #add_custom_command(TARGET ${ch_dir} COMMAND make WORKING_DIRECTORY ${ch_dir}${_proc})
  message(STATUS ${ch_dir}${_proc})
endforeach()
#add_custom_target(comphep_lib DEPENDS ${ch_dir}/sqme_aaaa/libsqme_aaaa.so ${ch_dir}/sqme_aaww/libsqme_aaww.so ${ch_dir}/sqme_aazz/libsqme_aazz.so)
add_custom_target(comphep_lib DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/bin/libsqme_aaaa.so ${CMAKE_CURRENT_SOURCE_DIR}/bin/libsqme_aaww.so ${CMAKE_CURRENT_SOURCE_DIR}/bin/libsqme_aazz.so)
#add_library(comphep OBJECT comphep_wraper.cpp ${comphep_sources})
#add_custom_target(comphep_lib COMMAND make WORKING_DIRECTORY ${processes})
#add_custom_target(comphep_lib COMMAND make WORKING_DIRECTORY ${ch_dir}sqme_aaaa)
add_library(comphep OBJECT comphep_wraper.cpp)
#target_link_libraries(comphep ${comphep_lib})
add_dependencies(comphep comphep_lib)
#set(GCC_COVERAGE_LINK_FLAGS "-lsqme_aaaa -lsqme_aazz -lsqme_aaww")
set_target_properties(comphep PROPERTIES LINKER_LANGUAGE CXX POSITION_INDEPENDENT_CODE ON)
