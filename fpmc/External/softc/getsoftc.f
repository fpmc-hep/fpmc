C23456
      SUBROUTINE GETSOFTC(SCORR,T1,T2,PHI,IOPT,ITABLE)
      INCLUDE 'softc.ini'
      REAL*8 SCORR,SQRTS,T1,T2,PHI
      DOUBLE PRECISION LINEAR3
      DOUBLE PRECISION REF_T1_0,REF_T1_1,REF_T2_0,REF_T2_1
      DOUBLE PRECISION REF_PHI_0,REF_PHI_1
      DOUBLE PRECISION FACT_T1,FACT_T2,FACT_PHI
      INTEGER IOPT,IT1,IT2,IPHI
      INTEGER ITABLE
!      CHARACTER(80) FILENAME
      EXTERNAL LINEAR3
      EXTERNAL INISOFT2TEV, INISOFT14TEV, INISOFT_EFFOPA2TEV,
     &INISOFT_EFFOPA14TEV
C
 1001 FORMAT(2F7.3,2F12.8)
C
      IF(IOPT.EQ.1)THEN
         IF(ITABLE.EQ.1) THEN
            CALL INISOFT2TEV()
         ELSEIF(ITABLE.EQ.2) THEN
            CALL INISOFT14TEV()
         ELSEIF(ITABLE.EQ.3)THEN
            CALL INISOFT_EFFOPA2TEV()
         ELSEIF(ITABLE.EQ.4)THEN
            CALL INISOFT_EFFOPA14TEV()
         ENDIF

                  

C         WRITE (0,*),'OPENING FILE',FILENAME
C         OPEN(UNIT=13,FILE=FILENAME,STATUS='OLD')
C         READ (13,*) SQRTS,SOFTCTMAX,SOFTCNDT,SOFTCNDPHI
C         PRINT *,'   SQRT(S)=',SQRTS,' GeV'
C         PRINT *,'   TMAX=',SOFTCTMAX
C         PRINT *,'   NDT=',SOFTCNDT
C         PRINT *,'   NDPHI=',SOFTCNDPHI
C         IF(SOFTCNDT.GT.NMAXDT)THEN
C            PRINT *,'GETSOFTC: TOO FINE BINNING IN T'
C            CALL EXIT()
C         ENDIF
C         IF(SOFTCNDPHI.GT.NMAXDPHI)THEN
C            PRINT *,'GETSOFTC: TOO FINE BINNING IN PHI'
C            CALL EXIT()
C         ENDIF
C         DO IT1=1,SOFTCNDT
C            DO IT2=1,IT1
C               DO IPHI=1,SOFTCNDPHI
C                  READ (13,*) T1,T2,PHI,SOFTC(IT1,IT2,IPHI)
C                  SOFTC(IT2,IT1,IPHI)=SOFTC(IT1,IT2,IPHI)
C               ENDDO
C            ENDDO
C         ENDDO
C         CLOSE(13)
C         SOFTCDT=SOFTCTMAX/(SOFTCNDT-1)
C         SOFTCDPHI=PI/(SOFTCNDPHI-1)
C         PRINT *,'SOFT CORRECTION TABLE WAS DOWNLOADED'
      ELSEIF(IOPT.EQ.2)THEN
         IT1=(-T1/SOFTCDT)+1
         IT2=(-T2/SOFTCDT)+1
         IPHI=(PHI/SOFTCDPHI)+1
         IF (DEBUG.GT.999) THEN
            PRINT *,'T1=',T1,'  IT1=',IT1
            PRINT *,'T2=',T2,'  IT2=',IT2
            PRINT *,'PHI=',PHI,'  IPHI=',IPHI
         ENDIF
         IF(IT1.GT.SOFTCNDT-1) IT1=SOFTCNDT-1
         IF(IT2.GT.SOFTCNDT-1) IT2=SOFTCNDT-1
         IF(IPHI.GT.SOFTCNDPHI-1) IPHI=SOFTCNDPHI-1
         IF(IT1.LT.1) IT1=1
         IF(IT2.LT.1) IT2=1
         IF(IPHI.LT.1) IPHI=1
         REF_T1_0=REAL(IT1-1)*SOFTCDT
         REF_T1_1=REAL(IT1)*SOFTCDT
         REF_T2_0=REAL(IT2-1)*SOFTCDT
         REF_T2_1=REAL(IT2)*SOFTCDT
         REF_PHI_0=REAL(IPHI-1)*SOFTCDPHI
         REF_PHI_1=REAL(IPHI)*SOFTCDPHI
         FACT_T1=(-T1-REF_T1_0)/SOFTCDT
         FACT_T2=(-T2-REF_T2_0)/SOFTCDT
         FACT_PHI=(PHI-REF_PHI_0)/SOFTCDPHI
         IF (DEBUG.GT.999) THEN
            PRINT *,'REF_T1_0=',REF_T1_0,'  FACT_T1',FACT_T1
            PRINT *,'REF_T2_0=',REF_T2_0,'  FACT_T2',FACT_T2
            PRINT *,'REF_PHI_0=',REF_PHI_0,'  FACT_PHI',FACT_PHI
         ENDIF
C         
         SCORR=LINEAR3(FACT_T1,FACT_T2,FACT_PHI,
     .                 SOFTC(IT1,IT2,IPHI),SOFTC(IT1+1,IT2,IPHI),
     .                 SOFTC(IT1,IT2+1,IPHI),SOFTC(IT1+1,IT2+1,IPHI),
     .                 SOFTC(IT1,IT2,IPHI+1),SOFTC(IT1+1,IT2,IPHI+1),
     .                 SOFTC(IT1,IT2+1,IPHI+1),
     .                 SOFTC(IT1+1,IT2+1,IPHI+1))
C
      ELSE
         PRINT *,'GETSOFTC: UNDEFINED VALUE OF IOPT PARAMETER'
      ENDIF
C
      END
